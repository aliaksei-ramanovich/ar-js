<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
<a-scene
        renderer="logarithmicDepthBuffer: true;"
        embedded
        loading-screen="enabled: false;"
        arjs="sourceType: webcam; debugUIEnabled: false;"
>
    <a-camera gps-new-camera rotation-reader look-controls position="0 2 0"></a-camera>
</a-scene>
</body>
</html>

<script>
    window.onload = () => {
        let testEntityAdded = false;
        const el = document.querySelector("[gps-new-camera]");
        el.addEventListener("gps-camera-update-position", e => {
            if (!testEntityAdded) {
                alert(`Got first GPS position: lon ${e.detail.position.longitude} lat ${e.detail.position.latitude}`);
                let model = document.createElement('a-entity');
                model.setAttribute('gps-new-entity-place', `latitude: ${e.detail.position.latitude + 0.001}; longitude: ${e.detail.position.longitude + 0.001};`);

                model.setAttribute('gltf-model', './assets/earth/earth_export.gltf');
                model.setAttribute('rotation', '0 180 0');
                model.setAttribute('position', '0 0.1 0');
                model.setAttribute('animation-mixer', 'loop: repeat');
                model.setAttribute('scale', '70 70 70');
                model.setAttribute('look-at', '[gps-new-camera]');
                model.addEventListener('loaded', () => {
                    window.dispatchEvent(new CustomEvent('gps-entity-place-loaded'))
                });
                document.querySelector("a-scene").appendChild(model);
            }
            testEntityAdded = true;
        });
    }
</script>
